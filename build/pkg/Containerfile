ARG ARCH=amd64
FROM archlinux-$ARCH:base-devel AS build

VOLUME /build

# RUN env | grep DBUS
RUN pacman-key --init && (pacman-key --populate archlinuxarm || true) \
    && pacman -Suy --noconfirm base-devel git python3 python-setuptools  \
    && rm -rf rootfs/var/lib/pacman/sync/* \
    && useradd -m build && echo "build ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/build \
    && mkdir -p /build && chown build:build /build

USER build
WORKDIR /build
RUN mkdir /home/build/.gnupg && \
    touch /home/build/.gnupg/gpg.conf && \
    echo "keyserver-options auto-key-retrieve" > /home/build/.gnupg/gpg.conf
